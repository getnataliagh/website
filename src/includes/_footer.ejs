<footer class="bg-[#0f172a] text-white">
  <div class="max-w-content mx-auto px-4 md:px-6 py-12 md:py-16">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 md:gap-12">
      <!-- Logo, Description & Badge -->
      <div class="lg:col-span-1">
        <a href="./" class="inline-block mb-4">
          <img
            src="../static/assets/images/logoNataliaSvg.svg"
            alt="<%= locals.site.name %>"
            class="h-10 w-auto"
          >
        </a>
        <p class="text-gray-300 text-sm leading-relaxed mb-6">
          <%= locals.site.description %>
        </p>
        <!-- Made in France Badge -->
        <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 border border-white/20">
          <svg class="w-4 h-4 text-blue-400" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
          </svg>
          <span class="text-xs font-medium text-gray-200"><%= locals.ui.hostedInFrance %></span>
        </div>
      </div>

      <!-- Solutions -->
      <div>
        <h3 class="text-base font-semibold mb-4 text-white"><%= locals.footer.solutions %></h3>
        <ul class="space-y-3">
          <% locals.footer.solutionLinks.forEach(function(link) { %>
          <li>
            <a href="<%= link.url %>" class="group flex items-center gap-2 text-gray-300 hover:text-white transition-colors text-sm">
              <% if (link.icon === 'phone') { %>
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
              </svg>
              <% } else if (link.icon === 'chart') { %>
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
              <% } else if (link.icon === 'message') { %>
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
              </svg>
              <% } else if (link.icon === 'calculator') { %>
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
              </svg>
              <% } %>
              <%= link.label %>
            </a>
          </li>
          <% }); %>
        </ul>
      </div>

      <!-- Secteurs -->
      <div>
        <h3 class="text-base font-semibold mb-4 text-white"><%= locals.footer.sectors %></h3>
        <ul class="space-y-3">
          <% locals.footer.sectorLinks.forEach(function(link) { %>
          <li>
            <a href="<%= link.url %>" class="group flex items-center gap-2 text-gray-300 hover:text-white transition-colors text-sm">
              <% if (link.icon === 'car') { %>
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"></path>
              </svg>
              <% } else if (link.icon === 'headset') { %>
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path>
              </svg>
              <% } else if (link.icon === 'help') { %>
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"></path>
              </svg>
              <% } else if (link.icon === 'clock') { %>
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <% } %>
              <%= link.label %>
            </a>
          </li>
          <% }); %>
        </ul>
      </div>

      <!-- Entreprise & Légal -->
      <div>
        <h3 class="text-base font-semibold mb-4 text-white"><%= locals.footer.company %></h3>
        <ul class="space-y-3">
          <% locals.footer.companyLinks.forEach(function(link) { %>
          <li>
            <a href="<%= link.url %>" class="group flex items-center gap-2 text-gray-300 hover:text-white transition-colors text-sm">
              <% if (link.icon === 'info') { %>
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <% } else if (link.icon === 'partners') { %>
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
              <% } else if (link.icon === 'press') { %>
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
              </svg>
              <% } else if (link.icon === 'email') { %>
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
              </svg>
              <% } %>
              <%= link.label %>
            </a>
          </li>
          <% }); %>
        </ul>
      </div>
    </div>

    <!-- Bottom Bar -->
    <div class="mt-12 pt-8 border-t border-white/10">
      <div class="flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="flex flex-col md:flex-row items-center gap-2 md:gap-4 text-center md:text-left">
          <p class="text-gray-400 text-sm">
            &copy; <%= locals.site.currentYear %> <%= locals.site.name %>. <%= locals.ui.allRightsReserved %>
          </p>
          <div class="flex items-center gap-4 text-xs text-gray-500">
            <% locals.navigation.footer.forEach(function(item, index) { %>
              <a href="<%= item.url %>" class="hover:text-gray-300 transition-colors">
                <%= item.label %>
              </a>
              <% if (index < locals.navigation.footer.length - 1) { %>
                <span class="text-gray-600">•</span>
              <% } %>
            <% }); %>
          </div>
        </div>

        <!-- Social Links -->
        <div class="flex items-center gap-4">
          <% if (locals.social.linkedin.href) { %>
          <a href="<%= locals.social.linkedin.href %>" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white transition-colors" aria-label="LinkedIn">
            <%- locals.social.linkedin.logo %>
          </a>
          <% } %>
          <% if (locals.social.twitter.href) { %>
          <a href="<%= locals.social.twitter.href %>" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white transition-colors" aria-label="Twitter">
            <%- locals.social.twitter.logo %>
          </a>
          <% } %>
          <a href="mailto:<%= locals.site.email %>" class="text-gray-400 hover:text-white transition-colors" aria-label="Email">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </div>
</footer>

<!-- Cookie Consent Banner -->
<div id="cookie-banner" class="fixed bottom-0 left-0 right-0 z-50 transform translate-y-full transition-transform duration-300 ease-out">
  <div class="bg-[#0f172a]/95 backdrop-blur-sm border-t border-white/10 shadow-2xl">
    <div class="max-w-content mx-auto px-4 md:px-6 py-4">
      <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
        <div class="flex items-center gap-3 text-sm text-gray-300">
          <svg class="w-5 h-5 text-primary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
          </svg>
          <span><%= locals.ui.cookieBannerText %></span>
          <a href="<%= locals.navigation.footer.find(function(item) { return item.slug && (item.slug.includes('confidentialite') || item.slug.includes('privacy')); }).url %>" class="text-primary hover:underline whitespace-nowrap"><%= locals.ui.cookieBannerLearnMore %></a>
        </div>
        <div class="flex items-center gap-3 flex-shrink-0">
          <button id="cookie-deny" class="px-4 py-2 text-sm font-medium text-gray-400 hover:text-white transition-colors">
            <%= locals.ui.cookieBannerDeny %>
          </button>
          <button id="cookie-accept" class="px-5 py-2 text-sm font-medium bg-primary hover:bg-primary/90 text-white rounded-lg transition-colors">
            <%= locals.ui.cookieBannerAccept %>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
<script src="./js/scroll-animations.js"></script>
<script src="./js/mobile-menu.js"></script>
<script src="./js/main.js"></script>

<!-- Matomo Analytics -->
<script>
(function() {
  'use strict';

  // Safe Matomo wrapper - resistant to adblockers
  var _paq = window._paq = window._paq || [];
  var matomoLoaded = false;
  var matomoBlocked = false;
  var CONSENT_KEY = 'matomo_consent';

  // Safe tracking function - never throws errors
  // IMPORTANT: Uses window._paq to avoid closure bug after piwik.js loads
  function track(args) {
    if (matomoBlocked) return;
    try {
      if (window._paq) window._paq.push(args);
    } catch (e) {
      // Silently ignore - Matomo blocked or failed
    }
  }

  // ============================================
  // RGPD Consent Management (Matomo Native)
  // ============================================

  // Check previous consent choice
  function getStoredConsent() {
    try {
      return localStorage.getItem(CONSENT_KEY);
    } catch (e) {
      return null;
    }
  }

  function setStoredConsent(value) {
    try {
      localStorage.setItem(CONSENT_KEY, value);
    } catch (e) {
      // localStorage not available
    }
  }

  // Require cookie consent before tracking (RGPD compliance)
  track(['requireCookieConsent']);

  // Check if user already gave consent
  var storedConsent = getStoredConsent();
  if (storedConsent === 'granted') {
    track(['setCookieConsentGiven']);
  } else if (storedConsent === 'denied') {
    track(['forgetCookieConsentGiven']);
  }
  // If null, waiting for user decision - no cookies until consent

  // Expose consent API globally for cookie banner integration
  window.matomoConsent = {
    // Call when user accepts cookies
    accept: function() {
      setStoredConsent('granted');
      track(['setCookieConsentGiven']);
    },
    // Call when user refuses cookies
    deny: function() {
      setStoredConsent('denied');
      track(['forgetCookieConsentGiven']);
    },
    // Check current consent status
    getStatus: function() {
      return getStoredConsent();
    },
    // Reset consent (user wants to change choice)
    reset: function() {
      try {
        localStorage.removeItem(CONSENT_KEY);
      } catch (e) {}
      track(['forgetCookieConsentGiven']);
    }
  };

  // Detect page type for custom dimension (FR + EN slugs)
  function getPageType() {
    var path = location.pathname;
    if (path === '/' || path.includes('index')) return 'homepage';
    // Solutions (FR + EN)
    if (path.includes('assistante-vocale-ia') || path.includes('voice-assistant-ai') ||
        path.includes('whatsapp') ||
        path.includes('analyse') || path.includes('analytics') ||
        path.includes('assistant-mail') || path.includes('email-assistant')) return 'solution';
    // Sectors (FR + EN)
    if (path.includes('automobile') || path.includes('automotive') ||
        path.includes('centre-d-appel') || path.includes('call-center') ||
        path.includes('helpdesk') || path.includes('hotline')) return 'sector';
    if (path.includes('contact')) return 'conversion';
    // Tools (FR + EN)
    if (path.includes('calculateur') || path.includes('calculator')) return 'tool';
    // Legal pages (FR + EN)
    if (path.includes('mentions-legales') || path.includes('legal-notice') ||
        path.includes('politique') || path.includes('privacy') ||
        path.includes('conditions') || path.includes('terms')) return 'legal';
    // Company pages (FR + EN)
    if (path.includes('a-propos') || path.includes('about') ||
        path.includes('partenaires') || path.includes('partners') ||
        path.includes('presse') || path.includes('press')) return 'company';
    return 'other';
  }

  // RGPD: Anonymize visitor IP (truncate last octet)
  track(['setIpTracking', false]);

  // RGPD: Respect browser Do Not Track setting
  track(['setDoNotTrack', true]);

  // Configure download extensions
  track(['setDownloadExtensions', 'pdf|doc|docx|xls|xlsx|ppt|pptx|zip|rar']);

  // Enable accurate link tracking
  track(['enableLinkTracking']);
  track(['setLinkTrackingTimer', 500]);

  // Enable heartbeat timer (15 seconds)
  track(['enableHeartBeatTimer', 15]);

  // Set custom dimension: Page Type (dimension ID 1)
  track(['setCustomDimension', 1, getPageType()]);

  // Set custom dimension: Language (dimension ID 2)
  var pageLang = location.pathname.startsWith('/en') ? 'en' : 'fr';
  track(['setCustomDimension', 2, pageLang]);

  // Set document title explicitly
  track(['setDocumentTitle', document.title]);

  // Track page view
  track(['trackPageView']);

  // Track visible content impressions
  track(['trackVisibleContentImpressions']);

  // Matomo configuration
  (function() {
    var u = "//managed-natalia-matomo-prod.apps.france-nuage.fr/";
    track(['setTrackerUrl', u + 'matomo.php']);
    track(['setSiteId', '1']);

    var d = document;
    var g = d.createElement('script');
    var s = d.getElementsByTagName('script')[0];
    g.async = true;
    g.src = u + 'matomo.js';

    // Detect if Matomo is blocked
    g.onload = function() {
      matomoLoaded = true;
    };
    g.onerror = function() {
      matomoBlocked = true;
      console.info('Analytics blocked - site continues normally');
    };

    if (s && s.parentNode) {
      s.parentNode.insertBefore(g, s);
    }
  })();

  // Wait for DOM ready
  document.addEventListener('DOMContentLoaded', function() {

    // ============================================
    // Cookie Banner Management
    // ============================================

    (function() {
      var banner = document.getElementById('cookie-banner');
      var acceptBtn = document.getElementById('cookie-accept');
      var denyBtn = document.getElementById('cookie-deny');

      if (!banner || !acceptBtn || !denyBtn) return;

      function showBanner() {
        banner.classList.remove('translate-y-full');
        banner.classList.add('translate-y-0');
      }

      function hideBanner() {
        banner.classList.remove('translate-y-0');
        banner.classList.add('translate-y-full');
      }

      // Show banner only if no consent decision has been made
      if (!window.matomoConsent.getStatus()) {
        setTimeout(showBanner, 1000); // Show after 1 second for better UX
      }

      acceptBtn.addEventListener('click', function() {
        window.matomoConsent.accept();
        hideBanner();
        track(['trackEvent', 'Consent', 'accept', 'Cookie Banner']);
      });

      denyBtn.addEventListener('click', function() {
        window.matomoConsent.deny();
        hideBanner();
        track(['trackEvent', 'Consent', 'deny', 'Cookie Banner']);
      });
    })();

    // ============================================
    // CTA Event Tracking
    // ============================================

    // Track "Demander une démo" clicks
    document.querySelectorAll('a[href*="contact"]').forEach(function(el) {
      el.addEventListener('click', function() {
        track(['trackEvent', 'CTA', 'click', 'Demander une démo', window.location.pathname]);
      });
    });

    // Track "Calculer mon ROI" / "Calculate ROI" clicks (FR + EN)
    document.querySelectorAll('a[href*="calculateur"], a[href*="calculator"]').forEach(function(el) {
      el.addEventListener('click', function() {
        track(['trackEvent', 'CTA', 'click', 'Calculate ROI', window.location.pathname]);
      });
    });

    // Track solution page clicks (FR + EN)
    document.querySelectorAll('a[href*="assistante-vocale-ia"], a[href*="voice-assistant-ai"], a[href*="whatsapp"], a[href*="analyse"], a[href*="analytics"], a[href*="assistant-mail"], a[href*="email-assistant"]').forEach(function(el) {
      el.addEventListener('click', function() {
        var solution = this.href.split('/').pop().replace('.html', '');
        track(['trackEvent', 'Navigation', 'solution_click', solution]);
      });
    });

    // Track sector page clicks (FR + EN)
    document.querySelectorAll('a[href*="automobile"], a[href*="automotive"], a[href*="centre-d-appel"], a[href*="call-center"], a[href*="helpdesk"], a[href*="hotline"]').forEach(function(el) {
      el.addEventListener('click', function() {
        var sector = this.href.split('/').pop().replace('.html', '');
        track(['trackEvent', 'Navigation', 'sector_click', sector]);
      });
    });

    // ============================================
    // Form Submission Tracking
    // ============================================

    document.querySelectorAll('form[action*="formspree"], form[method="POST"]').forEach(function(form) {
      form.addEventListener('submit', function() {
        var formName = form.querySelector('h2') ? form.querySelector('h2').textContent.trim() : 'Contact Form';
        track(['trackEvent', 'Form', 'submit', formName]);
        track(['trackGoal', 1]); // Goal ID 1: Demo Request
      });
    });

    // ============================================
    // Enhanced Outlink Tracking
    // ============================================

    document.querySelectorAll('a[target="_blank"], a[href^="mailto:"], a[href^="tel:"]').forEach(function(link) {
      link.addEventListener('click', function() {
        var href = this.href || '';
        var type = 'external';

        if (href.includes('linkedin')) type = 'social_linkedin';
        else if (href.includes('twitter') || href.includes('x.com')) type = 'social_twitter';
        else if (href.startsWith('mailto:')) type = 'email';
        else if (href.startsWith('tel:')) type = 'phone';

        track(['trackEvent', 'Outbound', type, href]);
      });
    });

    // ============================================
    // Scroll Depth Tracking
    // ============================================

    (function() {
      var depths = [25, 50, 75, 100];
      var tracked = {};
      var ticking = false;

      function checkScrollDepth() {
        var docHeight = document.documentElement.scrollHeight - window.innerHeight;
        if (docHeight <= 0) return;

        var scrollPercent = Math.round((window.scrollY / docHeight) * 100);

        depths.forEach(function(depth) {
          if (scrollPercent >= depth && !tracked[depth]) {
            tracked[depth] = true;
            track(['trackEvent', 'Engagement', 'scroll_depth', depth + '%', depth]);
          }
        });

        ticking = false;
      }

      window.addEventListener('scroll', function() {
        if (!ticking) {
          requestAnimationFrame(checkScrollDepth);
          ticking = true;
        }
      }, { passive: true });
    })();

    // ============================================
    // Calculator ROI Tracking (if on calculator page)
    // ============================================

    (function() {
      var callsInput = document.getElementById('calls');
      var missedInput = document.getElementById('missed');
      var costInput = document.getElementById('cost');
      var durationInput = document.getElementById('duration');

      if (!callsInput || !missedInput || !costInput || !durationInput) return;

      var calculatorStarted = false;
      var trackTimeout;

      function trackCalculatorStart() {
        if (!calculatorStarted) {
          calculatorStarted = true;
          track(['trackEvent', 'Calculator', 'start', 'ROI Calculator']);
        }
      }

      function trackCalculatorComplete() {
        clearTimeout(trackTimeout);
        trackTimeout = setTimeout(function() {
          var annualEl = document.getElementById('annual');
          if (annualEl) {
            var annualValue = parseInt(annualEl.textContent.replace(/\D/g, ''), 10) || 0;
            track(['trackEvent', 'Calculator', 'complete', 'Annual Savings', annualValue]);
            track(['trackGoal', 2]); // Goal ID 2: Calculator Completed
          }
        }, 2000);
      }

      [callsInput, missedInput, costInput, durationInput].forEach(function(input) {
        input.addEventListener('input', function() {
          trackCalculatorStart();
        });
        input.addEventListener('change', function() {
          track(['trackEvent', 'Calculator', 'adjust', this.id, parseInt(this.value, 10)]);
          trackCalculatorComplete();
        });
      });
    })();

  });

  // Expose safe track function globally for custom tracking
  window.matomoTrack = track;

})();
</script>
<!-- End Matomo Analytics -->
